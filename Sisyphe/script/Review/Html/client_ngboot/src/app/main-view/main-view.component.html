<!-- Page content -->
<div class="page d-flex flex-column">
  <!-- Bootstrap Navigation bar : dark-grey bar -->
  <nav class="navbar sticky-top navbar-expand-md navbar-dark bg-dark">
    <!-- brand logo -->
    <div class="navbar-brand ">
      <app-about></app-about>
    </div>
    <button class="navbar-toggler" type="button" (click)="isMenuCollapsed = !isMenuCollapsed">
      <span class="navbar-toggler-icon"></span>
    </button>
    <!-- Collapsed menu for small screen -->
    <div [ngbCollapse]="isMenuCollapsed" class="collapse navbar-collapse" >
      <div class="navbar-nav ml-auto my-2 my-md-0">
        <button class="btn btn-secondary d-inline-flex align-items-center my-1 my-md-0 mr-md-2" (click)="onTesterClicked()" type="submit">
          <bi name="play-circle" class="icon-button-text"></bi>Tester
        </button>
        <button class="btn btn-secondary d-inline-flex align-items-center my-1 my-md-0 mr-md-2" (click)="onTableClicked()" type="submit">
          <bi name="card-list" class="icon-button-text"></bi>Table
        </button>
        <!-- Search bar -->
        <div class="input-group my-1 my-md-0 mr-md-2">
          <input class="form-control" type="search" placeholder="Search" [(ngModel)]="searchInput"/>
          <div class="input-group-append">
            <button class="btn btn-secondary" type="submit" (click)="onSearchClicked(searchInput)">
              <bi name="search" class="icon-button"></bi>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- View content -->
  <div class="view flex-grow-1 d-flex flex-row">
    <!-- Sidebar -->
    <div class="sidebar col-12 col-md-3 d-flex flex-column">
      <!-- explorer view -->
      <div class="explorer-panel flex-even d-flex flex-column">
        <span class="table-header">Explorer</span>
        <div class="table-fixed flex-even">
          <table class="table table-dark table-hover table-cell">
            <tbody>
              <tr class="table-cursor" *ngFor="let file of files" [ngClass]="file.status ? 'table-dark' : ''" (click)="onFileClicked(file)">
                <td><div class="d-inline-flex align-items-center"><bi name="file-earmark-text-fill" class="icon-button-text"></bi>{{file.name}}</div></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- properties view -->
      <div class="properties-panel flex-even d-flex flex-column">
        <span class="table-header">Properties</span>
        <div class="table-fixed flex-even">
          <table class="table table-dark table-cell">
            <tbody>
              <tr>
                <td>Files type:</td>
                <td>{{fileContent.type}}</td>
              </tr>
              <tr>
                <td>Lines count:</td>
                <td>{{fileContent.linesCount}}</td>
              </tr>
              <tr>
                <td>Errors count:
                <div *ngIf="fileList.name == 'Diff'">(-solved +new)</div>
                </td>
                <td>{{fileContent.errorsCount}}
                <div *ngIf="fileList.name == 'Diff'">(-{{fileList.solved}} +{{fileList.newErrors}})</div>
                </td>
              </tr>
              <tr>
                <td>Classes count:</td>
                <td>{{fileContent.classesCount}}</td>
              </tr>
              <tr>
                <td>Enumerations count:</td>
                <td>{{fileContent.enumsCount}}</td>
              </tr>
              <tr>
                <td>Functions declarations count:</td>
                <td>{{fileContent.decMethodsCount}}</td>
              </tr>
              <tr>
                <td>Function definitions count:</td>
                <td>{{fileContent.defMethodsCount}}</td>
              </tr>
              <tr>
                <td>Attributes count:</td>
                <td>{{fileContent.attributesCount}}</td>
              </tr>
              <tr>
                <td>Macros count:</td>
                <td>{{fileContent.macrosCount}}</td>
              </tr>
              <tr>
                <td>Cyclomatic complexity avg:</td>
                <td>{{fileContent.complexityAvg}}</td>
              </tr>
          </table>
        </div>
      </div>
    </div>
    <!-- main panel -->
    <div class="main-panel col-12 col-md-9 pr-1 pl-1 pl-md-0 d-flex flex-column">
      <!-- code panel -->
      <div #codePanel class="code-panel flex-even">
        <app-prettify content="{{fileContent.content}}" (onErrorClickedHandler)="onErrorClicked($event[0])"></app-prettify>
      </div>
      <!-- bottom panel -->
      <div class="bottom-panel">
        <div #collapse="ngbCollapse" [(ngbCollapse)]="isBottomTableCollapsed">
          <div class="d-flex flex-row pl-1 py-1">
            <div ngbDropdown class="d-inline-block">
              <button class="btn btn-secondary dropdown-toggle d-inline-flex align-items-center" type="button" id="dropdownMenuButton" ngbDropdownToggle>
                <bi name="filter-circle" class="icon-button-text"></bi><span>List : {{fileList.name}}</span>
              </button>
              <div ngbDropdownMenu class="bg-dark" aria-labelledby="dropdownMenuButton">
                <button *ngFor="let filterName of filters" ngbDropdownItem (click)="onFilterClicked(filterName)">{{filterName}}</button>
              </div>
            </div>
            <div class="flex-even d-flex flex-row align-items-center" *ngIf="fileList.name!='Search'">
              <input type="text" class="form-control mx-2" placeholder="Filter rules" [(ngModel)]="filterInput"/>
              <app-rule-info></app-rule-info>
            </div>
          </div>
          <div #listInfo class="list-info">
            <table class="table table-dark table-hover table-cell my-0">
              <tbody>
              <!-- -->
                <tr class="table-cursor" *ngFor="let item of fileList.list | ruleFilter:{'query': filterInput, 'enabled': fileList.name!='Search'}" [ngClass]="item.clicked ? 'table-dark' : ''" (click)="onListClicked(item)" id="row-list-{{item.start}}">
                  <td class="table-column-center">
                    <div *ngIf="fileList.name=='Errors' || fileList.name=='Diff'; then exclamationBlock else infoBlock"></div>
                    <ng-template #exclamationBlock><div class="d-inline-flex align-items-center"><bi name="exclamation-circle-fill" class="icon-button-text"></bi></div></ng-template>
                    <ng-template #infoBlock><div class="d-inline-flex align-items-center"><bi name="info-circle-fill" class="icon-button-text"></bi></div></ng-template>                   
                  </td>
                  <td class="table-column-center">l.{{item.lineNumber}}</td>
                  <td>
                    <div *ngIf="item.description==''; then categoryBlock else descriptionBlock"></div>
                    <ng-template #categoryBlock>{{item.category}}</ng-template>
                    <ng-template #descriptionBlock>{{item.category}}: {{item.description}}</ng-template>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="bottom-panel d-flex flex-column align-items-center">
          <button class="btn btn-secondary d-inline-flex align-items-center mr-md-2" type="submit" (click)="onListView()">
            <div *ngIf="isBottomTableCollapsed; then chevronUp else chevronDown"></div>
            <ng-template #chevronUp><bi name="chevron-bar-up" class="icon-button"></bi></ng-template>
            <ng-template #chevronDown><bi name="chevron-bar-down" class="icon-button"></bi></ng-template>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
